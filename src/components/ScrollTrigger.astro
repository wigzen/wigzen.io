<html>
  <head>
    <link
      rel="stylesheet"
      href="https://codepen.io/GreenSock/pen/xxmzBrw/fcaef74061bb7a76e5263dfc076c363e.css"
    />
  </head>
  <body>
    <div id="page" class="site">
      <div id="feather" class="feather"></div>

      <header id="masthead" class="site-header" role="banner">
        <nav class="anchor-nav" role="navigation">
          <a href="#intro" class="anchor">Home</a>
          <a href="#panel-1" class="anchor">Panel 1</a>
          <a href="#panel-3" class="anchor">Panel 3</a>
          <a href="#panel-5" class="anchor">Panel 5</a>
          <a href="#map" class="anchor">Map</a>
        </nav>
      </header>

      <main id="content" class="site-content" role="main">
        <section id="intro" class="full-screen pt-5 gradient-orange">
          <h1>A title</h1>

          <div id="clouds-layer-1" class="clouds"></div>
          <div id="clouds-layer-2" class="clouds"></div>
        </section>

        <section id="panels">
          <div id="panels-container" style="width: 500%;">
            <article id="panel-1" class="panel full-screen gradient-green">
              <div class="container">
                <div class="row">
                  <div class="col-6">
                    <img src="" alt="" />
                  </div>
                  <div class="col-6 d-flex flex-column">
                    <h2>Panel 1</h2>

                    <p class="step-description">
                      Lorem Ipsum is simply dummy text of the printing and
                      typesetting industry. Including versions of Lorem Ipsum.
                    </p>

                    <div class="panels-navigation text-right">
                      <div class="nav-panel" data-sign="plus">
                        <a href="#panel-2" class="anchor">Next</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
            <article id="panel-2" class="panel full-screen gradient-blue">
              <div class="container">
                <div class="row">
                  <div class="col-6">
                    <img src="" alt="" />
                  </div>
                  <div class="col-6 d-flex flex-column">
                    <h2>Panel 2</h2>

                    <p class="step-description">
                      Lorem Ipsum is simply dummy text of the printing and
                      typesetting industry. Including versions of Lorem Ipsum.
                    </p>

                    <div class="panels-navigation">
                      <div class="nav-panel" data-sign="minus">
                        <a href="#panel-1" class="anchor">Prev</a>
                      </div>
                      <div class="nav-panel" data-sign="plus">
                        <a href="#panel-3" class="anchor">Next</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
            <article id="panel-3" class="panel full-screen gradient-green">
              <div class="container">
                <div class="row">
                  <div class="col-6">
                    <img src="" alt="" />
                  </div>
                  <div class="col-6 d-flex flex-column">
                    <h2>Panel 3</h2>

                    <p class="step-description">
                      Lorem Ipsum is simply dummy text of the printing and
                      typesetting industry. Including versions of Lorem Ipsum.
                    </p>

                    <div class="panels-navigation">
                      <div class="nav-panel" data-sign="minus">
                        <a href="#panel-2" class="anchor">Prev</a>
                      </div>
                      <div class="nav-panel" data-sign="plus">
                        <a href="#panel-4" class="anchor">Next</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
            <article id="panel-4" class="panel full-screen gradient-blue">
              <div class="container">
                <div class="row">
                  <div class="col-6">
                    <img src="" alt="" />
                  </div>
                  <div class="col-6 d-flex flex-column">
                    <h2>Panel 4</h2>

                    <p class="step-description">
                      Lorem Ipsum is simply dummy text of the printing and
                      typesetting industry. Including versions of Lorem Ipsum.
                    </p>

                    <div class="panels-navigation">
                      <div class="nav-panel" data-sign="minus">
                        <a href="#panel-3" class="anchor">Prev</a>
                      </div>
                      <div class="nav-panel" data-sign="plus">
                        <a href="#panel-5" class="anchor">Next</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
            <article id="panel-5" class="panel full-screen gradient-green">
              <div class="container">
                <div class="row">
                  <div class="col-6">
                    <img src="" alt="" />
                  </div>
                  <div class="col-6 d-flex flex-column">
                    <h2>Panel 5</h2>

                    <p class="step-description">
                      Lorem Ipsum is simply dummy text of the printing and
                      typesetting industry. Including versions of Lorem Ipsum.
                    </p>

                    <div class="panels-navigation text-right">
                      <div class="nav-panel" data-sign="minus">
                        <a href="#panel-4" class="anchor">Prev</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </section>

        <section id="map" class="full-screen gradient-orange"></section>
      </main>
    </div>
  </body>
</html>

<style>
  .full-screen {
    display: block;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  #intro {
    display: flex;
    flex-direction: column;
    justify-content: center;
    color: var(--color-just-black);
  }

  #masthead {
    position: fixed;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    z-index: 9999;
  }
  #masthead a {
    padding: 1rem 2rem;
  }

  #panels #panels-container {
    height: 100vh;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: nowrap;
    flex-wrap: nowrap;
    padding: 0;
    overflow: hidden;
    background-color: #ddd;
  }
  #panels #panels-container .panel {
    color: var(--color-just-black);
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    display: flex;
    text-align: left;
    align-items: center;
    justify-content: center;
    border-right: 1px solid #f00;
  }
  #panels #panels-container .panel img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  #panels #panels-container .panel .panels-navigation {
    width: 100%;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: end;
    -ms-flex-pack: end;
    justify-content: flex-end;
  }
  #panels #panels-container .panel .anchor-panel,
  #panels #panels-container .panel .nav-panel {
    text-transform: uppercase;
    margin-right: 2rem;
  }
  #panels #panels-container .panels-navigation {
    position: absolute;
    width: 100%;
    bottom: 2rem;
    right: 2rem;
  }

  a {
    color: var(--color-just-black);
  }
</style>
<script>
  import { gsap } from "gsap";
  import { ScrollToPlugin } from "gsap/ScrollToPlugin";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  // Register GSAP plugins for scroll-based animations
  gsap.registerPlugin(ScrollToPlugin, ScrollTrigger);

  /* Main navigation */
  // Get reference to the panels container that holds all panels
  const panelsContainer = document.querySelector(
    "#panels-container"
  ) as HTMLElement;
  let tween: gsap.core.Tween | null = null;

  // Set up click handlers for all navigation links
  document.querySelectorAll(".anchor").forEach((anchor) => {
    anchor.addEventListener("click", function (e: Event) {
      e.preventDefault();
      const target = e.target as HTMLElement;
      const href = target.getAttribute("href");
      if (!href) return;

      // Get the target panel element
      const targetElem = document.querySelector(href) as HTMLElement;
      if (!targetElem) return;

      // Initialize scroll position to the target element
      let scrollPosition: number | HTMLElement = targetElem;

      // If clicking on a panel within the panels container
      if (
        targetElem &&
        panelsContainer &&
        panelsContainer.isSameNode(targetElem.parentElement) &&
        tween?.scrollTrigger
      ) {
        // Calculate the total scroll distance
        const totalScroll = tween.scrollTrigger.end - tween.scrollTrigger.start;

        // Calculate total horizontal movement needed
        const totalMovement = (panels.length - 1) * targetElem.offsetWidth;
        // Calculate exact scroll position based on panel position
        scrollPosition = Math.round(
          tween.scrollTrigger.start +
            (targetElem.offsetLeft / totalMovement) * totalScroll
        );
      }

      // Animate window scroll to the calculated position
      gsap.to(window, {
        scrollTo: {
          y: scrollPosition,
          autoKill: false, // Prevent scroll from being interrupted
        },
        duration: 1, // Animation duration in seconds
      });
    });
  });

  /* Panels Animation Setup */
  // Get all panel elements
  const panels = gsap.utils.toArray(
    "#panels-container .panel"
  ) as HTMLElement[];

  if (panels.length <= 0) return;
  // Create the main horizontal scroll animation
  tween = gsap.to(panels, {
    // Move panels horizontally by -100% for each panel (except the first)
    xPercent: -100 * (panels.length - 1),
    ease: "none", // Linear movement for smooth scrolling
    scrollTrigger: {
      trigger: "#panels-container", // Element that triggers the animation
      pin: true, // Pin the container while scrolling
      start: "top top", // Start animation when container top hits viewport top
      scrub: 1, // Smooth scrubbing effect
      snap: {
        snapTo: 1 / (panels.length - 1), // Snap to each panel
        inertia: false, // Disable inertia for precise snapping
        duration: { min: 0.1, max: 0.1 }, // Quick snap duration
      },
      // Calculate end position based on container width
      end: () => "+=" + (panelsContainer.offsetWidth - innerWidth),
    },
  });
</script>
